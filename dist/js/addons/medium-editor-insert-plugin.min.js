/*! 
 * medium-editor-insert-plugin v0.3.9 - jQuery insert plugin for MediumEditor
 *
 * https://github.com/orthes/medium-editor-insert-plugin
 * 
 * Copyright (c) 2014 Pavel Linkesch (http://linkesch.sk)
 * Released under the MIT license
 */

!function(a){function b(){var a,b,c,d,e="";if(void 0!==window.getSelection){if(b=window.getSelection(),b.rangeCount){for(d=document.createElement("div"),a=0,c=b.rangeCount;c>a;a+=1)d.appendChild(b.getRangeAt(a).cloneContents());e=d.innerHTML}}else void 0!==document.selection&&"Text"===document.selection.type&&(e=document.selection.createRange().htmlText);return e}var c={};MediumEditor&&"function"==typeof MediumEditor&&(MediumEditor.prototype.serialize=function(){var b,c,d,e,f,g,h,i,j={};for(b=0;b<this.elements.length;b+=1){for(d=""!==this.elements[b].id?this.elements[b].id:"element-"+b,e=a(this.elements[b]).clone(),f=a(".mediumInsert",e),c=0;c<f.length;c++)g=a(f[c]),h=a(".mediumInsert-placeholder",g).children(),0===h.length?g.remove():(g.removeAttr("contenteditable"),a("img[draggable]",g).removeAttr("draggable"),g.hasClass("small")&&h.addClass("small"),a(".mediumInsert-buttons",g).remove(),h.unwrap());i=e.html().trim(),j[d]={value:i}}return j},MediumEditor.prototype.deactivate=function(){var b;if(!this.isActive)return!1;for(this.isActive=!1,void 0!==this.toolbar&&(this.toolbar.style.display="none"),document.documentElement.removeEventListener("mouseup",this.checkSelectionWrapper),b=0;b<this.elements.length;b+=1)this.elements[b].removeEventListener("keyup",this.checkSelectionWrapper),this.elements[b].removeEventListener("blur",this.checkSelectionWrapper),this.elements[b].removeAttribute("contentEditable");a.fn.mediumInsert.insert.$el&&a.fn.mediumInsert.insert.$el.mediumInsert("disable")},MediumEditor.prototype.activate=function(){var b;if(this.isActive)return!1;for(void 0!==this.toolbar&&(this.toolbar.style.display="block"),this.isActive=!0,b=0;b<this.elements.length;b+=1)this.elements[b].setAttribute("contentEditable",!0);this.bindSelect(),a.fn.mediumInsert.insert.$el&&a.fn.mediumInsert.insert.$el.mediumInsert("enable")}),a.fn.mediumInsert=function(b){return"string"==typeof b&&a.fn.mediumInsert.insert[b]?void a.fn.mediumInsert.insert[b]():(a.fn.mediumInsert.settings=a.extend(a.fn.mediumInsert.settings,b),this.each(function(){a(this).addClass("medium-editor-insert-plugin");var b="p, h1, h2, h3, h4, h5, h6, ol, ul, blockquote";a(this).on("dragover drop",b,function(a){return a.preventDefault(),!1}),a.fn.mediumInsert.insert.init(a(this)),a.each(a.fn.mediumInsert.settings.addons,function(b){if("undefined"!=typeof c[b]){var d=a.fn.mediumInsert.settings.addons[b];d.$el=a.fn.mediumInsert.insert.$el,c[b].init(d)}})}))},a.fn.mediumInsert.settings={enabled:!0,beginning:!1,addons:{images:{},embeds:{}}},a.fn.mediumInsert.registerAddon=function(a,b){c[a]=b},a.fn.mediumInsert.getAddon=function(a){return c[a]},a.fn.mediumInsert.insert={init:function(a){this.$el=a,this.isFirefox=navigator.userAgent.match(/firefox/i),this.setPlaceholders(),this.setEvents()},deselect:function(){document.getSelection().removeAllRanges()},disable:function(){a.fn.mediumInsert.settings.enabled=!1,a.fn.mediumInsert.insert.$el.find(".mediumInsert-buttons").addClass("hide")},enable:function(){a.fn.mediumInsert.settings.enabled=!0,a.fn.mediumInsert.insert.$el.find(".mediumInsert-buttons").removeClass("hide")},getMaxId:function(){var b=-1;return a('div[id^="mediumInsert-"]').each(function(){var c=parseInt(a(this).attr("id").split("-")[1],10);c>b&&(b=c)}),b},getButtons:function(b){var d,e=a.fn.mediumInsert.settings.editor,f=e&&e.options?e.options.buttonLabels:"";return d=a.fn.mediumInsert.settings.enabled?'<div class="mediumInsert-buttons"><a class="mediumInsert-buttonsShow">+</a><ul class="mediumInsert-buttonsOptions medium-editor-toolbar medium-editor-toolbar-active">':'<div class="mediumInsert-buttons hide"><a class="mediumInsert-buttonsShow">+</a><ul class="mediumInsert-buttonsOptions medium-editor-toolbar medium-editor-toolbar-active">',0===Object.keys(a.fn.mediumInsert.settings.addons).length?!1:("undefined"==typeof b?a.each(a.fn.mediumInsert.settings.addons,function(a){"undefined"==typeof c[a]?console.log('Addon "'+a+'" is not available. Did you forgot to include the related file?'):d+="<li>"+c[a].insertButton(f)+"</li>"}):d+="<li>"+c[b].insertButton(f)+"</li>",d+="</ul></div>")},setPlaceholders:function(){var b,c=this,d=a.fn.mediumInsert.insert.$el,e=this.getButtons();return e===!1?!1:(e='<div class="mediumInsert" contenteditable="false">'+e+'<div class="mediumInsert-placeholder"></div></div>',d.is(":empty")&&d.html("<p><br></p>"),void d.keyup(function(){var f,g=d.children(":last");(""===d.html()||"<br>"===d.html())&&d.html("<p><br></p>"),g.hasClass("mediumInsert")&&g.find(".mediumInsert-placeholder").children().length>0&&d.append("<p><br></p>"),c.isFirefox&&a(".mediumInsert .mediumInsert-placeholder:empty",d).each(function(){var b=a(this).parent();0===b.find(".mediumInsert-buttons div").length&&b.remove()}),f=c.getMaxId()+1;var h="p, h1, h2, h3, h4, h5, h6, ol, ul, blockquote";a.fn.mediumInsert.settings.beginning&&(b=d.children(h).first(),b.prev().hasClass("mediumInsert")===!1&&(b.before(e),b.prev(".mediumInsert").attr("id","mediumInsert-"+f).addClass("mediumInsert-first"),f++)),d.children(h).each(function(){a(this).next().hasClass("mediumInsert")===!1&&(a(this).after(e),a(this).next(".mediumInsert").attr("id","mediumInsert-"+f)),f++})}).keyup())},setEvents:function(){var d=this,e=a.fn.mediumInsert.insert.$el;e.on("selectstart mousedown",".mediumInsert",function(b){a(b.target).is("img")===!1&&b.preventDefault()}),e.on("blur",function(){var b,c=a(this).clone();c.find(".mediumInsert").remove(),b=c.html().replace(/^\s+|\s+$/g,""),(""===b||"<p><br></p>"===b)&&a(this).addClass("medium-editor-placeholder")}),e.on("cut copy",function(c){var d=a("<div></div>").html(b().replace(/<\/([a-zA-Z]+)\>/g,"</$1>\n"));d.find(".mediumInsert").remove(),c.originalEvent.clipboardData&&(c.preventDefault(),c.originalEvent.clipboardData.setData("text/html",d.html()),c.originalEvent.clipboardData.setData("text/plain",d.text())),window.clipboardData&&(c.preventDefault(),window.clipboardData.setData("Text",d.text())),"cut"===c.type&&document.execCommand("delete")}),e.on("keypress",function(a){d.isFirefox&&13===a.keyCode&&e.contents().each(function(){return function(a,b){return"#text"===b.nodeName&&""!==b.textContent.trim()?(document.execCommand("insertHTML",!1,"<p>"+b.data+"</p>"),b.remove()):void 0}}(this))}),e.on("keydown",function(a){return navigator.userAgent.match(/chrome/i)&&(e.children().last().removeClass("hide"),(a.ctrlKey||a.metaKey)&&65===a.which)?(a.preventDefault(),0===e.find("p").text().trim().length?!1:(e.children().last().addClass("hide"),document.execCommand("selectAll",!1,null))):void 0}),e.on("click",".mediumInsert-buttons a.mediumInsert-buttonsShow",function(){var b=a(this).siblings(".mediumInsert-buttonsOptions"),c=a(this).parent().siblings(".mediumInsert-placeholder");a(this).hasClass("active")?(a(this).removeClass("active"),b.hide(),a("a",b).show()):(a(this).addClass("active"),b.show(),a("a",b).each(function(){var d=a(this).attr("class").split("action-")[1],e=d.split("-")[0];a(".mediumInsert-"+e,c).length>0&&a("a:not(.action-"+d+")",b).hide()})),d.deselect()}),e.on("mouseleave",".mediumInsert",function(){a("a.mediumInsert-buttonsShow",this).removeClass("active"),a(".mediumInsert-buttonsOptions",this).hide()}),e.on("click",".mediumInsert-buttons .mediumInsert-action",function(b){b.preventDefault();var d=a(this).data("addon"),e=a(this).data("action"),f=a(this).parents(".mediumInsert-buttons").siblings(".mediumInsert-placeholder");c[d]&&c[d][e]&&c[d][e](f),a(this).parents(".mediumInsert").mouseleave()})}}}(jQuery);